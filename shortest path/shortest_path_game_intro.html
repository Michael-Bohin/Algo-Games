<!DOCTYPE html>
<html lang="cs">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Trinity">
    <meta name="description" content="Gamyfing learning experience">
    <meta name="keywords" contents="virtual, textbook, map, knowledge, infinite, generator, exercises">
    <title> Play to learn </title>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="fonts.css">

</head>

<body>        
    <div id="eagle">
        <p id="text1">Welcome to path finding universe!</p>
        <table class="gameintro">
            
        
            <tr>
                <td class="ml3">
                    You are on holidays, traveling around Europe with your friend.  ðŸŒž
                </td>
            </tr>
            <tr>
                <td class="ml3" id="text2">
                    
                </td>
            </tr>
            <tr>
                <td class="ml3" id="text3">
                    
                </td>
            </tr>
            <tr>
                <td class="ml3">
                    Sadly. 
                </td>
            </tr>
            <tr>
                <td class="ml3" id="text4">
                    
                </td>
            </tr>
            <tr>
                <td class="ml3">
                    You would like to find cheapest combination of flights. 
                </td>
            </tr>
            <tr>
                <td class="ml3">
                    Ready to play?
                </td>
            </tr>
            <tr>
                <td>
                    <!-- <form action="./shortest_path_game.html"> </form> -->
                        <button class="elipsa" id="e4" onclick="onLetsgo()" value="Play the game"> Let's go!</button>
                </td>
            </tr>
            <tr>
                <td>
                    <img id="europe" src="nasa europe.jpg">
                </td>
            </tr>
        
        </table>
        
        

    </div>   
</body> 

<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>

<script> 
    // possible start and goals, such that the directions make at least some sense using random generation 
    let choose_dest = [ 
        ['Reykjavik', 'Beirut'], 
        ['Dublin', 'Istanbul'],
        ['Oslo', 'Tripoli'],
        ['Lisbon', 'Helsinki'],
        ['Kiev', 'Rabat'], 
        ['Lisbon', 'Kiev'],
        ['Athens', 'Oslo'],
        ['Bucharest', 'Dublin'],
        ['Moscow', 'Reykjavik'], 
        ['Moscow', 'Lisbon'],
        ['Tripoli', 'Copenhagen'],
        ['Dublin', 'Riga'], 
        ['Rabat', 'Stockholm'],
        ['Rome', 'Stockholm']
    ];

    function randint(min, max) { // inclusive type of both min and max
        return Math.floor(Math.random() * (max - min + 1) ) + min;
    }

    let choice = randint(0, 13);
    let start = choose_dest[choice][0];
    let goal = choose_dest[choice][1];
    // half of the time go from each end
    if(Math.random() > 0.5) {
        let temp = start;
        start = goal;
        goal = temp;
    }

    sessionStorage.setItem("start", start);
    sessionStorage.setItem("goal", goal);

    let text1 = document.getElementById('text2');
    let text2 = document.getElementById('text3');
    let text3 = document.getElementById('text4');

    text1.innerHTML = `You have now been for a week in ${start}. `;
    text2.innerHTML = `And decided that your next destination will be ${goal}.`;
    text3.innerHTML = `There is no direct flight from ${start} to ${goal}! ðŸ˜žðŸ˜²`;

    var x, i, j, l, ll, selElmnt, a, b, c;
    /* Look for any elements with the class "custom-select": */
    x = document.getElementsByClassName("custom-select");
    l = x.length;
    for (i = 0; i < l; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0];
    ll = selElmnt.length;
    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "select-selected");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "select-items select-hide");
    for (j = 1; j < ll; j++) {
        /* For each option in the original select element,
        create a new DIV that will act as an option item: */
        c = document.createElement("DIV");
        c.innerHTML = selElmnt.options[j].innerHTML;
        c.addEventListener("click", function(e) {
            /* When an item is clicked, update the original select box,
            and the selected item: */
            var y, i, k, s, h, sl, yl;
            s = this.parentNode.parentNode.getElementsByTagName("select")[0];
            sl = s.length;
            h = this.parentNode.previousSibling;
            for (i = 0; i < sl; i++) {
                if (s.options[i].innerHTML == this.innerHTML) {
                    s.selectedIndex = i;
                    h.innerHTML = this.innerHTML;
                    y = this.parentNode.getElementsByClassName("same-as-selected");
                    yl = y.length;
                    for (k = 0; k < yl; k++) {
                        y[k].removeAttribute("class");
                    }
                    this.setAttribute("class", "same-as-selected");
                    break;
                }
            }
            h.click();
        });
        b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function(e) {
        /* When the select box is clicked, close any other select boxes,
        and open/close the current select box: */
        e.stopPropagation();
        closeAllSelect(this);
        this.nextSibling.classList.toggle("select-hide");
        this.classList.toggle("select-arrow-active");
    });
    }

    function closeAllSelect(elmnt) {
    /* A function that will close all select boxes in the document,
    except the current select box: */
    var x, y, i, xl, yl, arrNo = [];
    x = document.getElementsByClassName("select-items");
    y = document.getElementsByClassName("select-selected");
    xl = x.length;
    yl = y.length;
    for (i = 0; i < yl; i++) {
        if (elmnt == y[i]) {
        arrNo.push(i)
        } else {
        y[i].classList.remove("select-arrow-active");
        }
    }
    for (i = 0; i < xl; i++) {
        if (arrNo.indexOf(i)) {
        x[i].classList.add("select-hide");
        }
    }
    }

    /* If the user clicks anywhere outside the select box,
    then close all select boxes: */
    document.addEventListener("click", closeAllSelect);

    ///////////////////////////////////////////////////////////////////////////////////////////
    // Wrap every letter in a span
    var els = document.querySelectorAll(".ml3");
    els.forEach(function(userItem) {
        userItem.innerHTML = userItem.textContent.replace(/\S/g, "<span class='letter'>$&</span>");
    });
    anime.timeline({loop: false})
    .add({
        targets: '.ml3 .letter',
        opacity: [0,1],
        easing: "easeInOutQuad",
        duration: 600,
        delay: (el, i) => 30 * (i+1)
    })

    function onLetsgo () {
        var els = document.querySelectorAll(".select-selected");
        let a = "";
        let b = "";
        els.forEach(function(item, index) {
            if(index == 0) {
                a = item.innerHTML;
            }
            if(index == 1) {
                b = item.innerHTML;
            }
        });
        console.log(a);
        console.log(b);    
        
        if(a == "Select:" || b == "Select:") {
            // user didnt select game type yet 
            console.log("You must select game type before playing.");
        } else {
            sessionStorage.setItem("paths", a);
            sessionStorage.setItem("edge_type", b);
            window.location.href = "./shortest_path_game.html";
        }
    }

</script>

</html>